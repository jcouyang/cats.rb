test:
  pre:
    - bundle exec rspec */spec
deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - echo "---\n:rubygems_api_key: $RUBYGEMS_API" > ~/.gem/credentials
      - chmod 600 ~/.gem/credentials
      - VERSION=$(sed "s/v//" <<< $CIRCLE_TAG)
      - gem build data.either/data.either.gemspec
      - gem push data.either/data.either-$VERSION.gem
